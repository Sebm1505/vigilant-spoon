<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="title icon" href="{{ url_for('static', filename='img/title-img.png') }}">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
    
    <!-- Font Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <title>{% block title %}E-Library{% endblock %}</title>
</head>

<body>
    <!-- Hidden checkbox for toggle state -->
    <input type="checkbox" id="mobile-menu-checkbox" class="d-md-none">
    
    <!-- Mobile menu toggle button (label for checkbox) -->
    <label for="mobile-menu-checkbox" class="mobile-menu-toggle-label d-md-none">
        <span class="navbar-toggler-icon"></span>
    </label>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-md navbar-light d-none d-md-block">
        <div class="container-fluid">
            <div class="row">
                <!-- Desktop Sidebar (hidden on mobile) -->
                <div class="col-xl-2 col-lg-3 col-md-4 sidebar fixed-top d-none d-md-block">
                    <a href="#" class="navbar-brand text-white d-block mx-auto text-center py-3 bottom-border">SG Library</a>
                    
                    {% if current_user.is_authenticated %}
                    <!-- User profile (for both admin and regular users) -->
                    <div class="navbar-brand d-block mx-auto text-left py-3 mb-4 bottom-border">
                        {% if current_user.is_admin %}
                        <img src="{{ url_for('static', filename='img/admin.jpeg') }}" 
                             class="oblong-img" 
                             style="width: 60px; height: 40px; border-radius: 50%; margin-right: 10px; object-fit: cover;" 
                             alt="Admin Image">  
                        <span style="color: white; font-size:medium;">Admin</span>
                        {% else %}
                        <img src="{{ url_for('static', filename='img/admin.jpeg') }}" 
                             class="oblong-img" 
                             style="width: 60px; height: 40px; border-radius: 50%; margin-right: 10px; object-fit: cover; background-color: white;" 
                             alt="User Image"
                             onerror="this.style.display='none'">  
                        <span style="color: white; font-size:medium;">{{ current_user.name }}</span>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <ul class="navbar-nav flex-column mt-4">
                        <li class="nav-item" style="padding: 10px;">
                            <a href="{{ url_for('bookController.book_titles') }}" class="nav-link text-white">
                                <i class="fas fa-address-card text-light fa-lg mr-2"></i>Book Titles
                            </a>
                        </li>
                        
                        <!-- My Loans link (only show for authenticated non-admin users) -->
                        {% if current_user.is_authenticated and not current_user.is_admin %}
                        <li class="nav-item" style="padding: 10px;">
                            <a href="{{ url_for('bookController.my_loans') }}" class="nav-link text-white">
                                <i class="fas fa-clipboard text-light fa-lg mr-2"></i>Loans
                            </a>
                        </li>
                        {% endif %}
                        
                        <!-- New Book link (only show for admin users) -->
                        {% if current_user.is_authenticated and current_user.is_admin %}
                        <li class="nav-item">
                            <a href="{{ url_for('bookController.new_book') }}" class="nav-link text-white">
                                <i class="fas fa-cloud-upload-alt text-light fa-lg mr-2"></i>New Book
                            </a>
                        </li>
                        {% endif %}
                        
                        <!-- Login and Register links (only show when not authenticated) -->
                        {% if not current_user.is_authenticated %}
                        <li class="nav-item" style="padding: 10px;">
                            <a href="{{ url_for('auth.login') }}" class="nav-link text-white px-3 py-2">
                                <i class="fas fa-sign-in-alt text-light fa-lg me-2"></i>Login
                            </a>
                        </li>
                        <li class="nav-item" style="padding: 10px;">
                            <a href="{{ url_for('auth.register') }}" class="nav-link text-white">
                                <i class="fas fa-user-alt text-light fa-lg mr-2"></i>Register
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
                <!-- End of desktop sidebar -->

                <!-- Desktop Top navbar (hidden on mobile) -->
                <div class="col-xl-10 col-lg-9 col-md-8 ml-auto top-navbar fixed-top py-2 d-none d-md-block">
                    <div class="row align-items-center">
                        <div class="col-md-4 d-flex align-items-center">
                            <h4 class="text-uppercase mb-0" style="color: #2d5016; font-weight: 600;">{% block page_title %}Library{% endblock %}</h4>
                        </div>
                        <div class="col-md-8 text-right">
                            {% if current_user.is_authenticated %}
                            <a href="{{ url_for('auth.logout') }}" class="nav-link text-dark d-inline-block" style="font-weight: 600;">
                                <i class="fas fa-sign-out-alt text-dark fa-lg mr-2"></i>
                            </a>
                            {% endif %}
                            {% block navbar_content %}
                            <!-- Page-specific content goes here -->
                            {% endblock %}
                        </div>
                    </div>
                </div>
                <!-- End of desktop top navbar -->
            </div>
        </div>
    </nav>
    <!-- End of navbar -->

    <!-- Mobile Menu Container (pushes content down) -->
    <div class="mobile-menu-container d-md-none" id="mobileMenuContainer">
        <!-- Mobile Sidebar -->
        <div class="sidebar mobile-sidebar">
            <a href="#" class="navbar-brand text-white d-block mx-auto text-center bottom-border">SG Library</a>
            
            {% if current_user.is_authenticated %}
            <!-- User profile (for both admin and regular users) -->
            <div class="navbar-brand d-block mx-auto text-left px-3 py-3 bottom-border">
                <img src="{{ url_for('static', filename='img/admin.jpeg') }}" 
                     class="oblong-img" 
                     style="width: 60px; height: 40px; border-radius: 50%; margin-right: 10px; object-fit: cover; background-color: white;" 
                     alt="User Image"
                     onerror="this.style.display='none'">  
                <span style="color: white; font-size:  medium;">{{ current_user.name }}</span>
            </div>
            {% endif %}
            
            <ul class="navbar-nav flex-column mt-4">
                <li class="nav-item" style="padding: 10px;">
                    <a href="{{ url_for('bookController.book_titles') }}" class="nav-link text-white">
                        <i class="fas fa-address-card text-light fa-lg mr-2"></i>Book Titles
                    </a>
                </li>
                
                <!-- My Loans link (only show for authenticated non-admin users) -->
                {% if current_user.is_authenticated and not current_user.is_admin %}
                <li class="nav-item" style="padding: 10px;">
                    <a href="{{ url_for('bookController.my_loans') }}" class="nav-link text-white">
                        <i class="fas fa-clipboard text-light fa-lg mr-2"></i>Loans
                    </a>
                </li>
                {% endif %}
                
                <!-- New Book link (only show for admin users) -->
                {% if current_user.is_authenticated and current_user.is_admin %}
                <li class="nav-item" style="padding: 10px;">
                    <a href="{{ url_for('bookController.new_book') }}" class="nav-link text-white">
                        <i class="fas fa-cloud-upload-alt text-light fa-lg mr-2"></i>New Book
                    </a>
                </li>
                {% endif %}
                
                <!-- Login and Register links (only show when not authenticated) -->
                {% if not current_user.is_authenticated %}
                <li class="nav-item" style="padding: 10px;">
                    <a href="{{ url_for('auth.login') }}" class="nav-link text-white">
                        <i class="fas fa-sign-in-alt text-light fa-lg mr-2"></i>Login
                    </a>
                </li>
                <li class="nav-item" style="padding: 10px;">
                    <a href="{{ url_for('auth.register') }}" class="nav-link text-white">
                        <i class="fas fa-user-alt text-light fa-lg mr-2"></i>Register
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
        
        <!-- Mobile Top Navbar (immediately follows sidebar) -->
        <div class="top-navbar mobile-top-navbar">
            <div class="row align-items-center">
                <div class="col-6 text-left d-flex align-items-center">
                    <h4 class="text-uppercase mb-0" style="font-size: 1rem;">{{ self.page_title() }}</h4>
                </div>
                <div class="col-6 text-right">
                    {% if current_user.is_authenticated %}
                    <a href="{{ url_for('auth.logout') }}" class="nav-link text-dark d-inline-block" style="font-weight: 600;">
                        <i class="fas fa-sign-out-alt text-dark fa-lg mr-2"></i>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <!-- End of mobile menu container -->

    <!-- Flash messages display -->
    <div class="container-fluid mt-5">
        <div class="row">
            <div class="col-xl-10 col-lg-9 col-md-8 ml-auto">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert" 
                                 style="width: 100%; background-color: #d1ecf1; color: #0c5460; border-color: #bee5eb; margin-bottom: 0; padding: 10px 15px;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>{{ message }}</span>
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
        </div>
    </div>
    <!-- End of flash messages -->

    <!-- Main Content -->
    <section>
        <div class="container-fluid">
            <div class="row">
                <div class="col-xl-10 col-lg-9 col-md-8 ml-auto main-content">
                    <div class="row mt-md-3 mb-5">
                        {% block mainblock %}
                        {% endblock %}
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- End of main content -->

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
        integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>


</body>
</html>